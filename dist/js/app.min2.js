function getQueryVariable(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var o=t[n].split("=");if(decodeURIComponent(o[0])==e)return decodeURIComponent(o[1].replace(/\+/g," "))}}function updateUserDetails(){document.querySelector("#chatUserInfo").style.display="none",document.querySelector("#chatBox").style.display="block"}var name=getQueryVariable("name");if(name&&"undefined"!==name&&name.length>1){document.querySelector("#chatUserInfo").style.display="none",document.querySelector("#chatBox").style.display="block";var timeout,hidden,visibilityChange,socket=io(),room="WebxTutor Global Chat";$(".room-title").text(room),socket.on("connect",function(){console.log("Connected to Socket I/O Server!"),console.log(name+" wants to join  "+room),socket.emit("joinRoom",{name:name,room:room})}),setInterval(getOnlinetUsers,4e3),$("#messagebox").keyup(function(){console.log("happening"),typing=!0,$("#icon-type").removeClass(),socket.emit("typing",{text:name+" is typing ..."}),clearTimeout(timeout),timeout=setTimeout(timeoutFunction,1e3)}),void 0!==document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):void 0!==document.mozHidden?(hidden="mozHidden",visibilityChange="mozvisibilitychange"):void 0!==document.msHidden?(hidden="msHidden",visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange"),socket.on("typing",function(e){$(".typing").text(e.text)}),socket.on("onlineUsers",function(e){$(".onlineUsers").text(e),$(".onlineUsersCount").text(e.split(", ").length)}),socket.on("userSeen",function(e){var t=$("#icon-type");t.removeClass(),t.addClass("fa fa-check-circle"),e.read?t.addClass("msg-read"):t.addClass("msg-delieverd"),console.log(e)}),socket.on("message",function(e){console.log("New Message !"),console.log(e.text);var t=$(".messages"),n=$('<li class = "list-group-item"></li>'),o=moment.utc(e.timestamp).local().format("h:mm a");n.append("<strong>"+o+" "+e.name+"</strong>"),n.append("<p>"+e.text+"</p>"),t.append(n);var i=$("ul.messages.list-group"),s=i.offset(),a=i[0].scrollHeight;if($("ul.messages.list-group").animate({scrollTop:a-s.top}),document[hidden]){notifyMe(e);var m={text:name+" has not seen message",read:!1};socket.emit("userSeen",m)}else{m={text:name+" has seen message",read:!0,user:name};socket.emit("userSeen",m)}});var $form=$("#messageForm"),$message1=$form.find("input[name=message]");$form.on("submit",function(e){e.preventDefault();var t=$message1.val();if(""===(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;").trim()))return-1;socket.emit("message",{text:t,name:name});var n=$(".messages"),o=$('<li class = "list-group-item"></li>'),i=moment().format("h:mm a");o.append("<p class='myname'><strong>"+i+" "+name+"</strong></p>"),o.append($("<p>",{class:"mymessages",text:$message1.val()})),n.append(o),$message1.val("");var s=$("ul.messages.list-group"),a=s.offset(),m=s[0].scrollHeight;$("ul.messages.list-group").animate({scrollTop:m-a.top})})}function timeoutFunction(){typing=!1,socket.emit("typing",{text:""})}function getOnlinetUsers(){console.log("checking online users"),socket.emit("onlineUsers",{text:""})}function notifyMe(e){if("Notification"in window)if("granted"===Notification.permission){new Notification("WebxTutor Global Chat",{body:e.name+": "+e.text,icon:"/img/logo.png"}).onclick=function(e){e.preventDefault(),this.close();var t={text:name+" has seen message",read:!0,user:name};socket.emit("userSeen",t)}}else"denied"!==Notification.permission&&Notification.requestPermission(function(t){"granted"===t&&(new Notification("WebxTutor Global Chat",{body:e.name+": "+e.text,icon:"/img/logo.png"}).onclick=function(e){e.preventDefault(),this.close();var t={text:name+" has seen message",read:!0,user:name};socket.emit("userSeen",t)})});else alert("This browser does not support desktop notification,try Chromium!")}